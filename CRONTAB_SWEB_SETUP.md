# üïê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Crontab –¥–ª—è Sweb Shared Hosting

## üìã –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

–î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã Laravel –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ Sweb shared —Ö–æ—Å—Ç–∏–Ω–≥–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ cron –∑–∞–¥–∞—á–∏:

1. **Laravel Scheduler** - –æ—Å–Ω–æ–≤–Ω–æ–π –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ Laravel (–∑–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ –∑–∞–¥–∞—á–∏)
2. **Queue Worker** - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—á–µ—Ä–µ–¥–µ–π –¥–ª—è —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á

---

## üîß –ö–æ–º–∞–Ω–¥—ã Crontab –¥–ª—è Sweb

### 1Ô∏è‚É£ Laravel Scheduler (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û)
–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ Laravel –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É. –û–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –≤—Å–µ –∑–∞–¥–∞—á–∏, —É–∫–∞–∑–∞–Ω–Ω—ã–µ –≤ `app/Console/Kernel.php`:

```bash
* * * * * cd /home/your_username/domains/post && /usr/local/bin/php artisan schedule:run >> /dev/null 2>&1
```

**–ß—Ç–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç:**
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—á–µ—Ä–µ–¥–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤ (checkout) - –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—á–µ—Ä–µ–¥–∏ –∏–º–ø–æ—Ä—Ç–∞ —Ç–æ–≤–∞—Ä–æ–≤ - –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
- ‚úÖ –û—Ç–º–µ–Ω–∞ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤ - –∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç
- ‚úÖ –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —Å–µ—Å—Å–∏–π - —Ä–∞–∑ –≤ –¥–µ–Ω—å

---

### 2Ô∏è‚É£ Queue Worker (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø –¥–ª—è —Ç—è–∂–µ–ª—ã—Ö –∑–∞–¥–∞—á)
–î–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—á–µ—Ä–µ–¥–µ–π –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏:

```bash
* * * * * cd /home/your_username/domains/post && /usr/local/bin/php artisan queue:work database --sleep=3 --tries=3 --max-time=3600 >> /home/your_username/domains/post/storage/logs/queue.log 2>&1
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `database` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥—Ä–∞–π–≤–µ—Ä database –¥–ª—è –æ—á–µ—Ä–µ–¥–µ–π
- `--sleep=3` - –∂–¥–∞—Ç—å 3 —Å–µ–∫—É–Ω–¥—ã –º–µ–∂–¥—É –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏
- `--tries=3` - –º–∞–∫—Å–∏–º—É–º 3 –ø–æ–ø—ã—Ç–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- `--max-time=3600` - –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–π —á–∞—Å (–¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏)

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è Sweb

### –í–∞—Ä–∏–∞–Ω—Ç 1: –¢–æ–ª—å–∫–æ Laravel Scheduler (–ú–ò–ù–ò–ú–ê–õ–¨–ù–ê–Ø)
–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –º–∞–ª—ã—Ö –∏ —Å—Ä–µ–¥–Ω–∏—Ö –Ω–∞–≥—Ä—É–∑–æ–∫:

```bash
* * * * * cd /home/your_username/domains/post && /usr/local/bin/php artisan schedule:run >> /dev/null 2>&1
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: Scheduler + Queue Worker (–û–ü–¢–ò–ú–ê–õ–¨–ù–ê–Ø)
–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Å—Ä–µ–¥–Ω–∏—Ö –∏ –≤—ã—Å–æ–∫–∏—Ö –Ω–∞–≥—Ä—É–∑–æ–∫:

```bash
# Laravel Scheduler (–æ–±—Ä–∞–±–æ—Ç–∫–∞ checkout –∏ import –æ—á–µ—Ä–µ–¥–µ–π)
* * * * * cd /home/your_username/domains/post && /usr/local/bin/php artisan schedule:run >> /dev/null 2>&1

# Queue Worker –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á
* * * * * cd /home/your_username/domains/post && /usr/local/bin/php artisan queue:work database --sleep=3 --tries=3 --max-time=3600 >> /home/your_username/domains/post/storage/logs/queue.log 2>&1
```

---

## üìù –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –Ω–∞ Sweb

### –®–∞–≥ 1: –í–æ–π–¥–∏—Ç–µ –≤ cPanel
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://sweb.ru/cpanel
2. –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å

### –®–∞–≥ 2: –ù–∞–π–¥–∏—Ç–µ "Cron Jobs"
1. –í —Ä–∞–∑–¥–µ–ª–µ "Advanced" –Ω–∞–π–¥–∏—Ç–µ "Cron Jobs"
2. –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –Ω–µ–≥–æ

### –®–∞–≥ 3: –î–æ–±–∞–≤—å—Ç–µ –∑–∞–¥–∞—á—É
1. –í –ø–æ–ª–µ "Minute" –≤–≤–µ–¥–∏—Ç–µ: `*`
2. –í –ø–æ–ª–µ "Hour" –≤–≤–µ–¥–∏—Ç–µ: `*`
3. –í –ø–æ–ª–µ "Day" –≤–≤–µ–¥–∏—Ç–µ: `*`
4. –í –ø–æ–ª–µ "Month" –≤–≤–µ–¥–∏—Ç–µ: `*`
5. –í –ø–æ–ª–µ "Weekday" –≤–≤–µ–¥–∏—Ç–µ: `*`
6. –í –ø–æ–ª–µ "Command" –≤–≤–µ–¥–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É (—Å–º. –Ω–∏–∂–µ)

### –®–∞–≥ 4: –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—É—Ç—å
**–í–ê–ñ–ù–û!** –ó–∞–º–µ–Ω–∏—Ç–µ `/home/your_username/domains/post` –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π –ø—É—Ç—å:

```bash
# –î–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø—É—Ç–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ SSH:
pwd
```

–û–±—ã—á–Ω–æ –Ω–∞ Sweb –ø—É—Ç—å –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫:
- `/home/username/domains/yourdomain.com/public_html`
- `/home/username/public_html`

### –®–∞–≥ 5: –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –ø—É—Ç—å –∫ PHP
–ù–∞ Sweb –æ–±—ã—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:
- `/usr/local/bin/php` (PHP 8.x)
- `/usr/bin/php` (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞)

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ—Ä—Å–∏—é PHP:
```bash
/usr/local/bin/php -v
```

---

## üîç –§–∏–Ω–∞–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è

### –î–ª—è Laravel Scheduler (–∑–∞–º–µ–Ω–∏—Ç–µ –ø—É—Ç–∏):
```bash
* * * * * cd /home/your_username/domains/yourdomain.com/public_html && /usr/local/bin/php artisan schedule:run >> /dev/null 2>&1
```

### –î–ª—è Queue Worker (–∑–∞–º–µ–Ω–∏—Ç–µ –ø—É—Ç–∏):
```bash
* * * * * cd /home/your_username/domains/yourdomain.com/public_html && /usr/local/bin/php artisan queue:work database --sleep=3 --tries=3 --max-time=3600 >> /home/your_username/domains/yourdomain.com/public_html/storage/logs/queue.log 2>&1
```

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Laravel
```bash
tail -f storage/logs/laravel.log
```

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –æ—á–µ—Ä–µ–¥–∏
```bash
tail -f storage/logs/queue.log
```

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–±–ª–∏—Ü—ã –≤ –ë–î
```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—á–µ—Ä–µ–¥–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤
SELECT * FROM checkout_queue WHERE status = 'pending';

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—á–µ—Ä–µ–¥–∏ –∏–º–ø–æ—Ä—Ç–∞
SELECT * FROM import_queue WHERE status = 'pending';

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á
SELECT * FROM jobs;
```

---

## üö® –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞ 1: Cron –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞: `chmod -R 755 storage bootstrap/cache`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—É—Ç—å –∫ PHP: `/usr/local/bin/php -v`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ cron –≤ cPanel

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –û—à–∏–±–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –ë–î
**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `.env` —Ñ–∞–π–ª
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ë–î –¥–æ—Å—Ç—É–ø–Ω–∞
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ credentials –≤ `.env`

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –¢–∞–π–º–∞—É—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
**–†–µ—à–µ–Ω–∏–µ:**
- –£–≤–µ–ª–∏—á—å—Ç–µ –ª–∏–º–∏—Ç—ã –≤ –∫–æ–º–∞–Ω–¥–∞—Ö:
  ```bash
  --limit=50    # —É–º–µ–Ω—å—à–∏—Ç–µ –¥–æ 20-30
  --max-time=1800  # —É–º–µ–Ω—å—à–∏—Ç–µ –¥–æ 30 –º–∏–Ω—É—Ç
  ```

### –ü—Ä–æ–±–ª–µ–º–∞ 4: Queue Worker –ø–∞–¥–∞–µ—Ç
**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ supervisor (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ Sweb)
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ `schedule:run` –±–µ–∑ queue:work

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –°–æ–∑–¥–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞
```bash
# –§–∞–π–ª: check_queues.sh
#!/bin/bash

echo "=== Checkout Queue Status ==="
mysql -u username -p'password' -D database -e "SELECT status, COUNT(*) as count FROM checkout_queue GROUP BY status;"

echo ""
echo "=== Import Queue Status ==="
mysql -u username -p'password' -D database -e "SELECT status, COUNT(*) as count FROM import_queue GROUP BY status;"

echo ""
echo "=== Jobs Queue Status ==="
mysql -u username -p'password' -D database -e "SELECT COUNT(*) as count FROM jobs;"
```

–ó–∞–ø—É—Å–∫–∞–π—Ç–µ: `bash check_queues.sh`

---

## üéâ –ì–æ—Ç–æ–≤–æ!

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ cron –∑–∞–¥–∞—á –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- ‚úÖ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∑–∞–∫–∞–∑—ã –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã (–¥–æ 100 –∑–∞–∫–∞–∑–æ–≤ –≤ –º–∏–Ω—É—Ç—É)
- ‚úÖ –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä—ã (–¥–æ 50 —Ç–æ–≤–∞—Ä–æ–≤ –≤ –º–∏–Ω—É—Ç—É)
- ‚úÖ –û—Ç–º–µ–Ω—è—Ç—å –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã (–∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç)
- ‚úÖ –û—á–∏—â–∞—Ç—å —Å—Ç–∞—Ä—ã–µ —Å–µ—Å—Å–∏–∏ (—Ä–∞–∑ –≤ –¥–µ–Ω—å)

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `storage/logs/laravel.log`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ cron –ª–æ–≥–∏ –≤ cPanel
3. –°–≤—è–∂–∏—Ç–µ—Å—å —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Sweb –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è –ø—É—Ç–µ–π

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 27 –æ–∫—Ç—è–±—Ä—è 2025 –≥.
