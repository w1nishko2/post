# Обновления статистики магазина

## Новая функциональность

### 1. Пользовательский период анализа
- **Описание**: Возможность выбора произвольного периода для анализа статистики
- **Как использовать**: 
  1. На странице статистики выберите "Произвольный период" в выпадающем списке "Период"
  2. Появятся поля "Дата начала" и "Дата окончания"
  3. Укажите нужный диапазон дат
  4. Нажмите "Применить"

### 2. Генерация полного отчета в PDF
- **Описание**: Возможность экспорта всей статистики в PDF файл
- **Как использовать**:
  1. Настройте фильтры (бот, период)
  2. Нажмите кнопку "Отчет" рядом с кнопкой "Применить"
  3. PDF файл автоматически загрузится

## Технические детали

### Изменения в коде

#### 1. StatisticsController.php
- Добавлен метод `generateFullReport()` для создания PDF отчетов
- Добавлены методы `getDetailedVisitsData()` и `getDetailedOrdersData()` для детальной статистики
- Улучшена обработка пользовательских дат в методе `getPeriodDates()`

#### 2. resources/views/statistics/index.blade.php
- Добавлена кнопка "Отчет" для генерации PDF
- Улучшен JavaScript для показа/скрытия полей дат
- Добавлена обработка клика по кнопке генерации отчета

#### 3. resources/views/statistics/report.blade.php
- Новый шаблон для PDF отчета
- Включает всю основную статистику в удобном для печати формате
- Содержит детальные таблицы и графики

#### 4. routes/web.php
- Добавлен новый роут `statistics/generate-report` для экспорта PDF

### Зависимости
- Установлен пакет `barryvdh/laravel-dompdf` для генерации PDF
- Используется `Barryvdh\DomPDF\Facade\Pdf` для создания PDF файлов

## URL примеры

### Базовое использование
```
https://post/statistics
```

### С фильтром по боту
```
https://post/statistics?bot_id=3
```

### С пользовательским периодом
```
https://post/statistics?bot_id=3&period=custom&start_date=2025-10-01&end_date=2025-10-20
```

### Генерация отчета
```
https://post/statistics/generate-report?bot_id=3&period=last_30_days
```

## Возможности отчета

PDF отчет включает:
- ✅ Общую статистику (посещения, заказы, выручка)
- ✅ Посещения по дням
- ✅ Заказы по статусам
- ✅ Самые покупаемые товары
- ✅ Популярные страницы
- ✅ Источники трафика
- ✅ Последние заказы
- ✅ Статистику по устройствам

## Безопасность

- ✅ Проверка прав доступа к боту (пользователь может видеть только свои данные)
- ✅ Валидация входных параметров
- ✅ Защита от SQL-инъекций через использование Eloquent ORM
- ✅ Ограничение доступа через middleware `auth` и `statistics.access`