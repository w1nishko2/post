# ÐžÐ¿Ñ‚Ð¸Ð¼Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð° Ð¸ ÑƒÑÑ‚Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼

## ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹, Ð²Ñ‹ÑÐ²Ð»ÐµÐ½Ð½Ñ‹Ðµ Ð¸Ð· Ð»Ð¾Ð³Ð¾Ð²:

### 1. âŒ ÐžÑˆÐ¸Ð±ÐºÐ° `session:clear` command not found
**ÐŸÑ€Ð¸Ñ‡Ð¸Ð½Ð°:** Cron Ð½Ð° Ñ…Ð¾ÑÑ‚Ð¸Ð½Ð³Ðµ Ð¿Ñ‹Ñ‚Ð°ÐµÑ‚ÑÑ Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑŒ Ð½ÐµÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰ÑƒÑŽ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ `session:clear`.

**Ð ÐµÑˆÐµÐ½Ð¸Ðµ:** Ð˜ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¾ Ð² `app/Console/Kernel.php` - Ð·Ð°Ð¼ÐµÐ½ÐµÐ½Ð¾ Ð½Ð° `app:clear-sessions`.

### 2. â±ï¸ ÐŸÑ€ÐµÐ²Ñ‹ÑˆÐµÐ½Ð¸Ðµ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ (Timeout)
**ÐŸÑ€Ð¸Ñ‡Ð¸Ð½Ð°:** Ð˜Ð¼Ð¿Ð¾Ñ€Ñ‚ Ñ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¾Ð¹ Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ð¹ Ð¸Ð· Ð¯Ð½Ð´ÐµÐºÑ.Ð”Ð¸ÑÐºÐ° Ð·Ð°Ð½Ð¸Ð¼Ð°ÐµÑ‚ Ð¼Ð½Ð¾Ð³Ð¾ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸.

**Ð ÐµÑˆÐµÐ½Ð¸Ñ:**
- âœ… Ð£Ð²ÐµÐ»Ð¸Ñ‡ÐµÐ½ `timeout` Ð² Job Ñ 120 Ð´Ð¾ 180 ÑÐµÐºÑƒÐ½Ð´
- âœ… Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¾ ÑƒÐ²ÐµÐ»Ð¸Ñ‡ÐµÐ½Ð¸Ðµ `max_execution_time` Ð² PHP Ñ‡ÐµÑ€ÐµÐ· `set_time_limit(600)` Ð² ÐºÐ¾Ð½ÑÑ‚Ñ€ÑƒÐºÑ‚Ð¾Ñ€Ðµ Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð°
- âœ… Ð£Ð²ÐµÐ»Ð¸Ñ‡ÐµÐ½ Ð»Ð¸Ð¼Ð¸Ñ‚ Ð¿Ð°Ð¼ÑÑ‚Ð¸ Ð´Ð¾ 512M

### 3. ðŸš¦ ÐŸÐµÑ€ÐµÐ³Ñ€ÑƒÐ·ÐºÐ° Ð¾Ñ‡ÐµÑ€ÐµÐ´Ð¸
**ÐŸÑ€Ð¸Ñ‡Ð¸Ð½Ð°:** Jobs ÑÐ¾Ð·Ð´Ð°ÑŽÑ‚ÑÑ Ð±Ñ‹ÑÑ‚Ñ€ÐµÐµ, Ñ‡ÐµÐ¼ Ð¾Ð±Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°ÑŽÑ‚ÑÑ.

**Ð ÐµÑˆÐµÐ½Ð¸Ñ:**
- âœ… Ð£Ð²ÐµÐ»Ð¸Ñ‡ÐµÐ½Ð° Ð·Ð°Ð´ÐµÑ€Ð¶ÐºÐ° Ð¼ÐµÐ¶Ð´Ñƒ Jobs Ñ 2 Ð´Ð¾ 5 ÑÐµÐºÑƒÐ½Ð´ Ð´Ð»Ñ Ñ‚Ð¾Ð²Ð°Ñ€Ð¾Ð²
- âœ… Ð£Ð²ÐµÐ»Ð¸Ñ‡ÐµÐ½Ð° Ð·Ð°Ð´ÐµÑ€Ð¶ÐºÐ° Ð´Ð»Ñ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¹ Ñ 1 Ð´Ð¾ 3 ÑÐµÐºÑƒÐ½Ð´

## ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ñ…Ð¾ÑÑ‚Ð¸Ð½Ð³Ð°

### PHP Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ (Ð² `.htaccess` Ð¸Ð»Ð¸ `php.ini`):

```apache
# Ð’ Ñ„Ð°Ð¹Ð»Ðµ .htaccess (ÐµÑÐ»Ð¸ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÐµÑ‚ÑÑ)
php_value max_execution_time 600
php_value max_input_time 600
php_value memory_limit 512M
php_value post_max_size 64M
php_value upload_max_filesize 64M
```

### ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° CRON Ð½Ð° Ñ…Ð¾ÑÑ‚Ð¸Ð½Ð³Ðµ:

**Ð¡Ñ‚Ð°Ñ€Ð°Ñ (Ð½ÐµÐ¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð°Ñ) Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ°:**
```bash
php artisan session:clear  # âŒ Ð­Ñ‚Ð° ÐºÐ¾Ð¼Ð°Ð½Ð´Ð° Ð½Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚
```

**ÐŸÑ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð°Ñ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ°:**
```bash
# Ð—Ð°Ð¿ÑƒÑÐº Ð¿Ð»Ð°Ð½Ð¸Ñ€Ð¾Ð²Ñ‰Ð¸ÐºÐ° Laravel ÐºÐ°Ð¶Ð´ÑƒÑŽ Ð¼Ð¸Ð½ÑƒÑ‚Ñƒ
* * * * * cd /home/g/gamechann2/western-panda_ru && php artisan schedule:run >> /dev/null 2>&1

# Ð—Ð°Ð¿ÑƒÑÐº Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ° Ð¾Ñ‡ÐµÑ€ÐµÐ´Ð¸ (ÐµÑÐ»Ð¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ database queue)
* * * * * cd /home/g/gamechann2/western-panda_ru && php artisan queue:work --stop-when-empty --max-time=300 >> /dev/null 2>&1
```

### ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¾Ñ‡ÐµÑ€ÐµÐ´Ð¸:

```bash
# ÐŸÐ¾ÑÐ¼Ð¾Ñ‚Ñ€ÐµÑ‚ÑŒ Ð·Ð°Ð´Ð°Ñ‡Ð¸ Ð² Ð¾Ñ‡ÐµÑ€ÐµÐ´Ð¸
php artisan queue:monitor

# Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº Ð¾Ñ‡ÐµÑ€ÐµÐ´Ð¸ Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ
php artisan queue:work --tries=3 --timeout=300

# ÐžÑ‡Ð¸ÑÑ‚Ð¸Ñ‚ÑŒ failed jobs
php artisan queue:flush
```

## Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ð¸ Ð¿Ð¾ Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ñƒ

### Ð”Ð»Ñ Ð±Ð¾Ð»ÑŒÑˆÐ¸Ñ… Ñ„Ð°Ð¹Ð»Ð¾Ð² (Ð±Ð¾Ð»ÐµÐµ 50 Ñ‚Ð¾Ð²Ð°Ñ€Ð¾Ð²):

1. **Ð Ð°Ð·Ð±Ð¸Ð²Ð°Ð¹Ñ‚Ðµ Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚ Ð½Ð° Ñ‡Ð°ÑÑ‚Ð¸** - Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ð¿Ð¾ 20-30 Ñ‚Ð¾Ð²Ð°Ñ€Ð¾Ð² Ð·Ð° Ñ€Ð°Ð·
2. **ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐ¹Ñ‚Ðµ ÑÑ‚Ð°Ñ‚ÑƒÑ Ð¾Ñ‡ÐµÑ€ÐµÐ´Ð¸** Ð¿ÐµÑ€ÐµÐ´ Ð½Ð¾Ð²Ñ‹Ð¼ Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð¾Ð¼
3. **ÐÐµ Ð·Ð°Ð¿ÑƒÑÐºÐ°Ð¹Ñ‚Ðµ Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¾ Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð¾Ð² Ð¾Ð´Ð½Ð¾Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ð¾**

### ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÑ‚Ð°Ñ‚ÑƒÑÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ð¹:

```php
// Ð’ ÐºÐ¾Ð½ÑÐ¾Ð»Ð¸ Laravel Tinker
php artisan tinker

// ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ñ‚Ð¾Ð²Ð°Ñ€Ñ‹ Ñ Ð½ÐµÐ·Ð°Ð²ÐµÑ€ÑˆÑ‘Ð½Ð½Ð¾Ð¹ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¾Ð¹
Product::whereIn('images_download_status', ['pending', 'processing'])->count();

// Ð¢Ð¾Ð²Ð°Ñ€Ñ‹ Ñ Ð¾ÑˆÐ¸Ð±ÐºÐ°Ð¼Ð¸
Product::where('images_download_status', 'failed')->get(['id', 'name', 'images_download_error']);
```

### ÐœÐ¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³ Jobs:

```bash
# ÐŸÐ¾ÑÐ¼Ð¾Ñ‚Ñ€ÐµÑ‚ÑŒ failed jobs
php artisan queue:failed

# ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ failed jobs
php artisan queue:retry all

# ÐžÑ‡Ð¸ÑÑ‚Ð¸Ñ‚ÑŒ failed jobs
php artisan queue:flush
```

## ÐžÐ¿Ñ‚Ð¸Ð¼Ð¸Ð·Ð°Ñ†Ð¸Ð¸ Ð² ÐºÐ¾Ð´Ðµ

### âœ… Ð’Ð½ÐµÑÑ‘Ð½Ð½Ñ‹Ðµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ:

1. **ProductsImport.php:**
   - Ð£Ð²ÐµÐ»Ð¸Ñ‡ÐµÐ½ `max_execution_time` Ð´Ð¾ 600 ÑÐµÐºÑƒÐ½Ð´ (10 Ð¼Ð¸Ð½ÑƒÑ‚)
   - Ð£Ð²ÐµÐ»Ð¸Ñ‡ÐµÐ½ `memory_limit` Ð´Ð¾ 512M
   - Ð£Ð²ÐµÐ»Ð¸Ñ‡ÐµÐ½Ð° Ð·Ð°Ð´ÐµÑ€Ð¶ÐºÐ° Ð¼ÐµÐ¶Ð´Ñƒ Jobs Ñ 2 Ð´Ð¾ 5 ÑÐµÐºÑƒÐ½Ð´

2. **DownloadProductImagesJob.php:**
   - Ð£Ð²ÐµÐ»Ð¸Ñ‡ÐµÐ½ `timeout` Ñ 120 Ð´Ð¾ 180 ÑÐµÐºÑƒÐ½Ð´
   - Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¾ `maxExceptions = 3`
   - Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¾ ÑƒÐ²ÐµÐ»Ð¸Ñ‡ÐµÐ½Ð¸Ðµ `max_execution_time` Ð² Ð¼ÐµÑ‚Ð¾Ð´Ðµ `handle()`

3. **DownloadCategoryPhotoJob.php:**
   - Ð£Ð²ÐµÐ»Ð¸Ñ‡ÐµÐ½ `timeout` Ñ 120 Ð´Ð¾ 180 ÑÐµÐºÑƒÐ½Ð´
   - Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¾ `maxExceptions = 3`
   - Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¾ ÑƒÐ²ÐµÐ»Ð¸Ñ‡ÐµÐ½Ð¸Ðµ `max_execution_time` Ð² Ð¼ÐµÑ‚Ð¾Ð´Ðµ `handle()`

4. **Console/Kernel.php:**
   - Ð˜ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð° ÐºÐ¾Ð¼Ð°Ð½Ð´Ð° `session:clear` Ð½Ð° `app:clear-sessions`
   - Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¾ ÐµÐ¶ÐµÐ´Ð½ÐµÐ²Ð½Ð¾Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ Ð¾Ñ‡Ð¸ÑÑ‚ÐºÐ¸ ÑÐµÑÑÐ¸Ð¹

## ÐœÐ¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³ Ð¸ Ð´ÐµÐ±Ð°Ð³

### ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ Ð»Ð¾Ð³Ð¾Ð² Ð½Ð° Ñ…Ð¾ÑÑ‚Ð¸Ð½Ð³Ðµ:

```bash
# ÐŸÐ¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸
tail -n 100 storage/logs/laravel.log

# Ð›Ð¾Ð³Ð¸ Ð² Ñ€ÐµÐ°Ð»ÑŒÐ½Ð¾Ð¼ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸
tail -f storage/logs/laravel.log

# ÐŸÐ¾Ð¸ÑÐº ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ñ‹Ñ… Ð¾ÑˆÐ¸Ð±Ð¾Ðº
grep "ERROR" storage/logs/laravel.log

# ÐŸÐ¾Ð¸ÑÐº Ð¿Ð¾ Ð´Ð°Ñ‚Ðµ
grep "2025-10-26" storage/logs/laravel.log
```

### ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ€Ð°Ð·Ð¼ÐµÑ€Ð° Ð¾Ñ‡ÐµÑ€ÐµÐ´Ð¸:

```bash
# Ð”Ð»Ñ database queue
php artisan tinker
DB::table('jobs')->count();

# Ð”Ð»Ñ Redis queue (ÐµÑÐ»Ð¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ)
redis-cli
LLEN queues:default
```

## ÐšÐ¾Ð½Ñ‚Ñ€Ð¾Ð»ÑŒÐ½Ñ‹Ð¹ ÑÐ¿Ð¸ÑÐ¾Ðº Ð¿ÐµÑ€ÐµÐ´ Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð¾Ð¼

- [ ] ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ, Ñ‡Ñ‚Ð¾ Ð¾Ñ‡ÐµÑ€ÐµÐ´ÑŒ Ð¿ÑƒÑÑ‚Ð°Ñ (`php artisan queue:monitor`)
- [ ] Ð£Ð±ÐµÐ´Ð¸Ñ‚ÑŒÑÑ, Ñ‡Ñ‚Ð¾ queue:work Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½
- [ ] ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ð»Ð¾Ð³Ð¸ Ð½Ð° Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ðµ ÐºÑ€Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ñ… Ð¾ÑˆÐ¸Ð±Ð¾Ðº
- [ ] Ð£Ð±ÐµÐ´Ð¸Ñ‚ÑŒÑÑ, Ñ‡Ñ‚Ð¾ Ñ…Ð²Ð°Ñ‚Ð°ÐµÑ‚ Ð¼ÐµÑÑ‚Ð° Ð½Ð° Ð´Ð¸ÑÐºÐµ
- [ ] Ð Ð°Ð·Ð±Ð¸Ñ‚ÑŒ Ð±Ð¾Ð»ÑŒÑˆÐ¾Ð¹ Ñ„Ð°Ð¹Ð» Ð½Ð° Ñ‡Ð°ÑÑ‚Ð¸ (ÐµÑÐ»Ð¸ > 50 Ñ‚Ð¾Ð²Ð°Ñ€Ð¾Ð²)

## Ð’ ÑÐ»ÑƒÑ‡Ð°Ðµ Ð·Ð°Ð²Ð¸ÑÐ°Ð½Ð¸Ñ Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð°

1. **ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ð¿Ñ€Ð¾Ñ†ÐµÑÑÑ‹:**
   ```bash
   ps aux | grep artisan
   ```

2. **ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ queue worker:**
   ```bash
   php artisan queue:restart
   ```

3. **ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ failed jobs:**
   ```bash
   php artisan queue:failed
   ```

4. **ÐžÑ‡Ð¸ÑÑ‚Ð¸Ñ‚ÑŒ Ð¸ Ð¿ÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ:**
   ```bash
   php artisan queue:flush
   php artisan cache:clear
   php artisan config:clear
   ```

## ÐšÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ñ‹ Ð´Ð»Ñ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ¸

Ð•ÑÐ»Ð¸ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹ ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÑŽÑ‚ÑÑ, Ð¿Ñ€ÐµÐ´Ð¾ÑÑ‚Ð°Ð²ÑŒÑ‚Ðµ:
- ÐŸÐ¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ 200 ÑÑ‚Ñ€Ð¾Ðº Ð¸Ð· `storage/logs/laravel.log`
- Ð’Ñ‹Ð²Ð¾Ð´ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ `php artisan queue:failed`
- Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÑŽ Ð¾ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ°Ñ… PHP (`php artisan tinker` -> `phpinfo();`)
